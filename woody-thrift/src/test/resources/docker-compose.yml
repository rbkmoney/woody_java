version: '2'
services:
  # To init base configuration run:
  # docker exec -ti  infrastructurem_inspector_1 bash
  # ./scripts/dominant/commit-base-fixture.sh -v
  inspector:
    image: dr.rbkmoney.com/rbkmoney/inspector:87c553e38fb05b97fc45221f46500509d9b63958
    container_name: inspector

  hellgate:
    image: dr.rbkmoney.com/rbkmoney/hellgate:e4c62bee3747272c38dfd6405f8f08b96e62651c
    command: [ "/opt/hellgate/bin/hellgate",  "foreground"]
    ports:
      - "8022:8022"
    volumes:
      - ./hellgate/sys.config:/opt/hellgate/releases/1/sys.config
    depends_on:
      - machinegun
      - dominant
      - shumway

  machinegun:
    image: dr.rbkmoney.com/rbkmoney/machinegun:bde2440a87e8311b6e2db90e915f8efdaa520ba1
    command: ["/opt/machinegun/bin/machinegun", "foreground"]
    expose:
      - "8022"
    volumes:
      - ./machinegun/sys.config:/opt/machinegun/releases/0.1.0/sys.config

  dominant:
    image: dr.rbkmoney.com/rbkmoney/dominant:b79f1e6acf5fd07ac60a51f9551faca48115770f
    command: ["/opt/dominant/bin/dominant", "foreground"]
    expose:
      - "8022"
    volumes:
      - ./dominant/sys.config:/opt/dominant/releases/0.1/sys.config
    depends_on:
      - machinegun

  shumway:
    image: dr.rbkmoney.com/rbkmoney/shumway:94e25fd3a3e7af4c73925fb051d999d7f38c271d
    entrypoint:
      - java
    expose:
      - "8022"
    command:
      -Xmx512m
      -jar /opt/shumway/shumway.jar
      --spring.datasource.url=jdbc:postgresql://shumway-db:5432/shumway
      --spring.datasource.username=postgres
      --spring.datasource.password=postgres
    depends_on:
      - shumway-db

  shumway-db:
    image: dr.rbkmoney.com/rbkmoney/postgres:9.6
    environment:
      - POSTGRES_DB=shumway
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - SERVICE_NAME=shumway-db

networks:
  default:
    driver: bridge
    driver_opts:
      com.docker.network.enable_ipv6: "true"
      com.docker.network.bridge.enable_ip_masquerade: "true"
